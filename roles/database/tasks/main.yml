---
# tasks file for database
- name: Prepare Environment
  block:
    - name: Creating Data Dir
      ansible.builtin.file:
        path: "{{ database_data_dir }}"
        state: directory
        mode: '0750'
    - name: Creating Log Dir
      ansible.builtin.file:
        path: "{{ database_log_dir }}"
        state: directory
        mode: '0750'

- name: Run Environment
  block:
    - name: Pull database image
      community.docker.docker_image_pull:
        name: "{{ database_image }}"

    - name: Create/Update Database Container
      community.docker.docker_container:
        name: "{{ database_name }}"
        image: "{{ database_image }}"
        env: "{{ database_env }}"
        ports: "{{ database_ports }}"
        volumes:  "{{ database_volumes }}"
        healthcheck: "{{ database_healthcheck }}"
        state: present

    - name: Start Database Container
      community.docker.docker_container:
        name: "{{ database_name }}"
        state: started

    - name: Wait Healthy
      community.docker.docker_container:
        name: "{{ database_name }}"
        state: healthy
        healthy_wait_timeout: "{{ database_healthy_wait_timeout }}"