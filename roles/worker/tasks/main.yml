---
# tasks file for worker
- name: Prepare Environment
  block:
    - name: Creating Data Dir
      ansible.builtin.file:
        path: "{{ worker_data_dir }}"
        state: directory
        mode: '0750'
    - name: Creating Log Dir
      ansible.builtin.file:
        path: "{{ worker_log_dir }}"
        state: directory
        mode: '0750'

- name: Run Environment
  block:
    - name: Pull image
      community.docker.docker_image_pull:
        name: "{{ worker_image }}"

    - name: Create/Update Container
      community.docker.docker_container:
        name: "{{ worker_name }}"
        image: "{{ worker_image }}"
        env: "{{ worker_env }}"
        ports: "{{ worker_ports }}"
        volumes:  "{{ worker_volumes }}"
        healthcheck: "{{ worker_healthcheck }}"
        state: present

    - name: Start Container
      community.docker.docker_container:
        name: "{{ worker_name }}"
        state: started

    - name: Wait Healthy
      community.docker.docker_container:
        name: "{{ worker_name }}"
        state: healthy
