# Что надо настроить:

# webservers
# - certbot https://github.com/geerlingguy/ansible-role-certbot
# - configure nginx https://github.com/geerlingguy/ansible-role-nginx
# - caching
# - redirect to https

# worker
# - install docker compose
# - configure user
# - configure firewall
# - configure persistent volumes
# - configure s3
# - docker run

# db
# - for db
# -  migration

---
- name: All Servers Preparation
  hosts: all
  become: true
  tags:
    - common
  roles:
    - role: common

- name: minio Deployment
  hosts: minio
  become: true
  tags:
    - minio
  roles:
    - role: docker
      when: env == "dev"
    - role: container
      when: env == "dev"

- name: Database Deployment
  hosts: db
  become: true
  tags:
    - db
  roles:
    - role: docker
    - role: container

- name: Worker Deployment
  hosts: workers
  become: true
  tags:
    - worker
  roles:
    - role: docker
    - role: container

- name: Webservers Deployment
  hosts: webservers
  become: true
  tags:
    - webserver
  roles:
    - role: nginx
#     - role: certbot

